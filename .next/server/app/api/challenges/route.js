"use strict";(()=>{var e={};e.id=21,e.ids=[21],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},37845:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>y,originalPathname:()=>L,patchFetch:()=>P,requestAsyncStorage:()=>g,routeModule:()=>C,serverHooks:()=>m,staticGenerationAsyncStorage:()=>T,staticGenerationBailout:()=>U});var s,a,n={};r.r(n),r.d(n,{GET:()=>A,POST:()=>h});var o=r(95419),i=r(69108),u=r(99678),l=r(78070),c=r(3214),d=r(63235);(function(e){e.assertEqual=e=>{},e.assertIs=function(e){},e.assertNever=function(e){throw Error()},e.arrayToEnum=e=>{let t={};for(let r of e)t[r]=r;return t},e.getValidEnumValues=t=>{let r=e.objectKeys(t).filter(e=>"number"!=typeof t[t[e]]),s={};for(let e of r)s[e]=t[e];return e.objectValues(s)},e.objectValues=t=>e.objectKeys(t).map(function(e){return t[e]}),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{let t=[];for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},e.find=(e,t)=>{for(let r of e)if(t(r))return r},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&Number.isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t})(s||(s={})),(a||(a={})).mergeShapes=(e,t)=>({...e,...t}),s.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),s.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class E extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(e){return e.message},r={_errors:[]},s=e=>{for(let a of e.issues)if("invalid_union"===a.code)a.unionErrors.map(s);else if("invalid_return_type"===a.code)s(a.returnTypeError);else if("invalid_arguments"===a.code)s(a.argumentsError);else if(0===a.path.length)r._errors.push(t(a));else{let e=r,s=0;for(;s<a.path.length;){let r=a.path[s];s===a.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(a))):e[r]=e[r]||{_errors:[]},e=e[r],s++}}};return s(this),r}static assert(e){if(!(e instanceof E))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,s.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){let t={},r=[];for(let s of this.issues)if(s.path.length>0){let r=s.path[0];t[r]=t[r]||[],t[r].push(e(s))}else r.push(e(s));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}E.create=e=>new E(e);class p extends Error{constructor(e,t=500,r=!0){super(e),this.statusCode=t,this.isOperational=r,Error.captureStackTrace(this,this.constructor)}}class _ extends p{constructor(e,t){super(e,400),this.details=t}}function f(e){if(console.error("Error:",e),e instanceof p)return l.Z.json({error:e.message,statusCode:e.statusCode,...e instanceof _&&{details:e.details}},{status:e.statusCode});if(e instanceof E)return l.Z.json({error:"Validation failed",statusCode:400,details:e.errors.map(e=>({field:e.path.join("."),message:e.message}))},{status:400});if(e&&"object"==typeof e&&"code"in e)switch(e.code){case"P2002":return l.Z.json({error:"A record with this information already exists",statusCode:409},{status:409});case"P2025":return l.Z.json({error:"Record not found",statusCode:404},{status:404});case"P2003":return l.Z.json({error:"Foreign key constraint failed",statusCode:400},{status:400});default:return l.Z.json({error:"Database error",statusCode:500},{status:500})}return l.Z.json({error:"Internal server error",statusCode:500},{status:500})}async function h(e){try{let{userId:t,plan:r}=await e.json();if(!t||!r)return l.Z.json({error:"User ID and plan are required"},{status:400});if(await c._.challengeAccount.findFirst({where:{userId:t,state:"ACTIVE"}}))return l.Z.json({error:"User already has an active challenge"},{status:409});let s=await c._.ruleset.findUnique({where:{plan:r.toUpperCase()}});if(!s)return l.Z.json({error:"Invalid subscription plan"},{status:400});let a=await c._.challengeAccount.create({data:{userId:t,rulesetId:s.id,startBalance:1e4,equity:1e4,highWaterMark:1e4,state:"ACTIVE"},include:{ruleset:!0,user:{select:{name:!0,email:!0}}}});return await (0,d.U)({userId:t,action:d.A.CHALLENGE_ACCOUNT_CREATED,payload:{challengeAccountId:a.id,plan:r.toUpperCase(),startBalance:1e4,rulesetId:s.id}}),l.Z.json({challengeAccount:a,message:"Challenge account created successfully"},{status:201})}catch(e){return f(e)}}async function A(e){try{let{searchParams:t}=new URL(e.url),r=t.get("userId"),s=t.get("state");if(!r)return l.Z.json({error:"User ID is required"},{status:400});let a={userId:r};s&&(a.state=s);let n=await c._.challengeAccount.findMany({where:a,include:{ruleset:!0,user:{select:{name:!0,email:!0}},bets:{select:{id:!0,status:!0,stake:!0,potentialPayout:!0,placedAt:!0},orderBy:{placedAt:"desc"},take:10}},orderBy:{startedAt:"desc"}});return l.Z.json({challenges:n})}catch(e){return f(e)}}let C=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/challenges/route",pathname:"/api/challenges",filename:"route",bundlePath:"app/api/challenges/route"},resolvedPagePath:"/Users/samirkassam/Desktop/PP2/profitplay/app/api/challenges/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:g,staticGenerationAsyncStorage:T,serverHooks:m,headerHooks:y,staticGenerationBailout:U}=C,L="/api/challenges/route";function P(){return(0,u.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:T})}},63235:(e,t,r)=>{r.d(t,{A:()=>n,U:()=>a});var s=r(3214);async function a(e){try{await s._.auditLog.create({data:{userId:e.userId,action:e.action,payload:e.payload,ip:e.ip}})}catch(e){console.error("Failed to create audit log:",e)}}let n={USER_SIGNUP:"USER_SIGNUP",USER_LOGIN:"USER_LOGIN",USER_LOGOUT:"USER_LOGOUT",SUBSCRIPTION_CREATED:"SUBSCRIPTION_CREATED",SUBSCRIPTION_UPDATED:"SUBSCRIPTION_UPDATED",SUBSCRIPTION_CANCELLED:"SUBSCRIPTION_CANCELLED",CHALLENGE_ACCOUNT_CREATED:"CHALLENGE_ACCOUNT_CREATED",CHALLENGE_ACCOUNT_UPDATED:"CHALLENGE_ACCOUNT_UPDATED",BET_PLACED:"BET_PLACED",BET_CANCELLED:"BET_CANCELLED",BET_SETTLED:"BET_SETTLED",RULE_VIOLATION:"RULE_VIOLATION",CHALLENGE_PASSED:"CHALLENGE_PASSED",CHALLENGE_FAILED:"CHALLENGE_FAILED",CHALLENGE_PAUSED:"CHALLENGE_PAUSED",ADMIN_ACTION:"ADMIN_ACTION",PAYOUT_REQUESTED:"PAYOUT_REQUESTED",PAYOUT_APPROVED:"PAYOUT_APPROVED",PAYOUT_REJECTED:"PAYOUT_REJECTED"}},3214:(e,t,r)=>{r.d(t,{_:()=>a});var s=r(53524);let a=globalThis.prisma??new s.PrismaClient}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[638,206],()=>r(37845));module.exports=s})();